%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Case Studies}
\label{s:case-studies}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%
We wrote data disguises via \sys for three real applications:
Lobsters~\cite{lobsters},
WebSubmit~\cite{websubmit-rs-anon},
and HotCRP~\cite{hotcrp}.
%
We fully integrated \sys with two applications, Lobsters and WebSubmit.
%
In the following, we discuss our experience writing these disguises and integrating
\sys into the applications.
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Lobsters}

%
Lobsters is a link-sharing and discussion platform with 14.5k users~\cite{lobsters},
written as a Ruby-on-Rails application backed by a MySQL database.
%
Lobsters supports account deletion, implemented manually by the developers in Ruby.
%
The current Lobsters deletion policy
\one{} hides the user account by flagging it as deleted (but retains it in the \fn{users} table);
\two{} deletes the users' invitations;
\three{} hides comments with negative votes by flagging them as deleted (but leaves
the comments in the database);
\four{} hides private messages by flagging them as deleted (but retains the message
in the database); and
\five{} optionally decorrelates a user's stories and comments by reassigning them to
to a special \fn{inactive-user}.
%
This policy allows users to return by reverting the ``deleted'' flags, but it is
not GDPR-compliant, as personally-identifiable data remains in the database after
account removal.
%

%
We implemented three disguises for Lobsters: the current Lobsters deletion
policy as a disguise, a GDPR-compliant account deletion disguise, and automatic data decay,
which anonymizes user's contributions after some time without activity on the site.
%
All disguises use \sys's high-level API.
%

\paragraph{GDPR-compliant Account Deletion.}
%
We changed the account deletion button in Lobsters's UI to trigger a disguise in \sys.
%
This disguise:
\one{} deletes the user account (and stores the encrypted details in \sys's store);
\two{} deletes information that's only relevant to the individual user, such as their
invitations, hats, and saved stories (and stores it encryptedly in \sys's store);
\three{} modifies story and comment content to ``[deleted content]'', but retains the
database objects in order to preserve comment threads (and nested threads) on stories;
\four{} hides private messages by marking them as deleted (but retains them in the
database) and decorrelates them from the account-deleting user; and
\five{} and decorrelates votes, stories, comments, and moderations on the user's
data by associating each remaining object with a unique pseudoprincipal.
%
This preserves application semantics for other users---\eg vote counts remain consistent
even after users delete their accounts, and other users' comments remain visible and
editable---while better protecting the privacy of deleted users.
%
Furthermore, important information such as moderations on the user's content remain in
the database, and \sys will recorrelate it if the user restores their account.
%
After the disguise is applied, Lobsters emails the user a URL that embeds the locator
produced by \sys.
%
When clicked, this URL allows the user to restore their account.
%

\paragraph{Data Decay.}
%
Our account decay disguise helps Lobsters users automatically gain privacy
after a period of inactivity (\eg a year).
%
We added a cron job that applies the data decay disguise to user accounts that have
been inactive for over a year.
%
Data decay:
\one{} deletes the user's account (and stores its details);
\two{} deletes information that's only relevant to the user, such as their invitations, hats,
and saved stories (again, storing it);
\three{} and decorrelates votes, stories, comments, and moderations on the
user's data by associating them with pseudoprincipals.
%
While similar to account deletion, data decay does not remove story or comment
content.
%
This preserves greater utility for other users, but also potentially retains
identifying information within the content.
%
Lobsters sends the user an email which informs them that their data has decayed,
and which includes URLs to reactivate or completely delete their account.
%
The URLs embed the locator produced by the data decay disguise, and take the user
to a form that requests their private key to complete the operation.
%

\paragraph{Integration.}
%
Our version of Lobsters is end-to-end integrated with \sys.
%
Lobster's Ruby code communicates with \sys through a JSON-HTTP API.
Lobster's disguises are written in 734 LoC of Rust and installed on \sys's server (most of which are
boilerplate schema annotations indicate \eg foreign key relationships).
%
We modified 85 lines of code in Lobsters's 160k LoC implementation, and generated a
Ruby client library via Swagger~\cite{swagger}, which Lobsters uses to invoke \sys's
API.
%
These modifications took less than one person-day for developers familiar with
\sys and Lobsters, but unfamiliar with Ruby.
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{WebSubmit}
\label{s:case-websubmit}

%
We integrated \sys with WebSubmit~\cite{websubmit-rs-anon} as a Rust library.
%
Our version of WebSubmit supports the two disguises described in our \S\ref{s:api}
running example: instructor-initiated answer anonymization, and GDPR-compliant
user account deletion.
%
Our modified WebSubmit sends locators and keys to users via email, and we added
new HTTP endpoints for editing disguised data and restoring a deleted account.
%

%
The original WebSubmit has 922 LoC; adding \sys's disguises required an additional 261 LoC
to specify the disguises, and 460 LoC to implement two additional HTTP endpoints and modify 
existing code with \eg authorization checks when editing (potentially anonymized) lectures.
Overall, the process took 1 person-day for a developer familiar with \sys, but
unfamiliar with WebSubmit.
%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{HotCRP}
\label{s:case-hotcrp}

%
HotCRP is a conference management application with a schema consisting of users
(reviewers/PC members and authors), paper submissions, reviews, comments, tags,
and per-user data such as watched papers and review ratings~\cite{hotcrp}.
%
We wrote two disguises for HotCRP: a universal conference anonymization disguise
(invoked by the PC chairs after the conference), and a GDPR-compliant account
deletion disguise.
%
Both disguises use the high-level \sys API.
%
%\sys-HotCRP also supports review editing after
%anonymization by emailing a link with the appropriate locators to anonymized users. Both disguises
%are implemented using \sys's higher-level API.
%
Universal conference anonymization decorrelates users from their submissions,
reviews, and comments, as well as per-user data such as watched papers.
%
User accounts remain in the database, but have no data.
%
Account deletion \one{} deletes the user's account; \two{} deletes information
that's only relevant to the user, such as their review preferences;
\three{} deletes their author relationships to papers; and
\four{} decorrelates the remainder of their data, such as reviews, to
individual pseudoprincipals.
%
The decorrelation of reviews makes them difficult to reassociate with one
another or with the natural principal.
%
Pseudoprincipals have suitable default properties provided by HotCRP; for example,
they are marked as disabled, so that they have no permissions and cannot log in.
%
This account deletion disguise removes a user's relationship to co-authored papers,
but does not remove the papers themselves; a different policy might go even
further and automatically delete a submission whose last author is removed.
%

An end-to-end integration with the HotCRP client is future work; however, we believe
that the required modifications would be similar to those in Lobsters.
